# ~/.login_autostart: start programs on every login

### start old (pre-assuan) gpg-agent
export GPG_TTY=$(tty)
GPG_AGENT_ENV_FILE=$HOME/.gnupg/gpg-agent-info
if [ -f "$GPG_AGENT_ENV_FILE" ]; then
	. "$GPG_AGENT_ENV_FILE"
	export GPG_AGENT_INFO
fi
# file may be old, try connecting
gpg-agent > /dev/null 2>&1
if [ "$?" != "0" ]; then
	eval $(gpg-agent --daemon --sh --write-env-file=$GPG_AGENT_ENV_FILE)
fi

### start ssh agent
SSH_AGENT_ENV_FILE=$HOME/.ssh/ssh-agent-info
if [ -f "$SSH_AGENT_ENV_FILE" ]; then
	. "$SSH_AGENT_ENV_FILE" > /dev/null
	# file may be old, try connecting
	if [ -z "$(ps aux|grep $SSH_AGENT_PID|grep ssh-agent)" ]; then
		# daemon does not exist with this pid, start new one
		ssh-agent -s > $SSH_AGENT_ENV_FILE
		. "$SSH_AGENT_ENV_FILE" > /dev/null
	fi
fi

### start mpd and mpdscribble
[ -x /usr/bin/mpd ] && \
	start-stop-daemon --quiet --start --user $USER --pidfile ~/.mpd/pid \
	--oknodo --startas /usr/bin/mpd
[ -x /usr/bin/mpdscribble ] && \
	start-stop-daemon --quiet --start --user $USER --pidfile ~/.mpdscribble/pid \
	--oknodo --startas /usr/bin/mpdscribble -- --conf ~/.mpdscribble/mpdscribble.conf
