# ~/.login_autostart: start programs on every login

### restart pulseaudio inside dbus session for module-dbus
pulseaudio --kill
pulseaudio --start --log-target=syslog

### start ssh agent
SSH_AGENT_ENV_FILE=$HOME/.ssh/ssh-agent-info-`hostname`
start_ssh_agent() {
	echo Starting new SSH Agent...
	ssh-agent -s > "$SSH_AGENT_ENV_FILE"
	. "$SSH_AGENT_ENV_FILE"
}

if [ -r "$SSH_AGENT_ENV_FILE" ]; then
	. "$SSH_AGENT_ENV_FILE" > /dev/null

	# file may be old, try connecting
	if [ -z "$(ps aux|grep $USER|grep $SSH_AGENT_PID|grep ssh-agent)" ] || \
	   [ ! -S "$SSH_AUTH_SOCK" ]; then
		# daemon does not exist with this pid, start new one
		start_ssh_agent
	fi
else
	# no agent env file yet
	start_ssh_agent
fi

### start mpd
if [ -x /usr/bin/mpd -a -r ~/.mpd/mpd.conf ] ; then
	start-stop-daemon --quiet --start --user $USER --pidfile ~/.mpd/pid \
		--oknodo --startas /usr/bin/mpd -- ~/.mpd/mpd.conf
	export MPD_PORT=6601
fi
